# Apache vhost (HTTPS) reverse proxy to Gunicorn over UNIX socket
# Requires Apache 2.4.39+ and mod_proxy, mod_headers, mod_ssl enabled

<VirtualHost *:443>
    ServerName observatory.example.org

    SSLEngine On
    SSLCertificateFile /etc/letsencrypt/live/observatory.example.org/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/observatory.example.org/privkey.pem

    ProxyPreserveHost On
    RequestHeader set X-Forwarded-Proto "https"

    # Proxy to Gunicorn over UNIX socket (HTTP protocol) under /ost_status
    ProxyPass        /ost_status unix:/run/observatory_presence/gunicorn.sock|http://localhost/
    ProxyPassReverse /ost_status http://localhost/

    # Optional: tighten read-only endpoints
    <Location /ost_status/status>
        <LimitExcept GET>
            Require all denied
        </LimitExcept>
    </Location>
</VirtualHost>

# Optional HTTP to HTTPS redirect
# <VirtualHost *:80>
#   ServerName observatory.example.org
#   RewriteEngine On
#   RewriteRule ^/(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]
# </VirtualHost>


